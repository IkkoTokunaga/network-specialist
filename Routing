2026-01-19
# ルーティング
ルータやL3スイッチでIPパケットの転送先を切り替える機能のこと。
## ネクストホップ
IPパケットを転送すべき隣接機器（隣接ノード）のIPアドレスのこと
## ルーティングテーブル
宛先ネットワークとネクストホップを管理している表
## route print -4
```
route print -4
===========================================================================
インターフェイス一覧
 33...00 15 5d f5 23 41 ......Hyper-V Virtual Ethernet Adapter
 12...00 a5 54 ca 55 63 ......Microsoft Wi-Fi Direct Virtual Adapter #3
  6...02 a5 54 ca 55 62 ......Microsoft Wi-Fi Direct Virtual Adapter #4
 18...00 a5 54 ca 55 62 ......Intel(R) Wi-Fi 6E AX211 160MHz
  1...........................Software Loopback Interface 1
===========================================================================

IPv4 ルート テーブル
===========================================================================
アクティブ ルート:
ネットワーク宛先        ネットマスク          ゲートウェイ       インターフェイス  メトリック
          0.0.0.0          0.0.0.0      192.168.0.1      192.168.0.4     30
        127.0.0.0        255.0.0.0            リンク上         127.0.0.1    331
        127.0.0.1  255.255.255.255            リンク上         127.0.0.1    331
  127.255.255.255  255.255.255.255            リンク上         127.0.0.1    331
      192.168.0.0    255.255.255.0            リンク上       192.168.0.4    286
      192.168.0.4  255.255.255.255            リンク上       192.168.0.4    286
    192.168.0.255  255.255.255.255            リンク上       192.168.0.4    286
    192.168.112.0    255.255.240.0            リンク上     192.168.112.1    271
    192.168.112.1  255.255.255.255            リンク上     192.168.112.1    271
  192.168.127.255  255.255.255.255            リンク上     192.168.112.1    271
        224.0.0.0        240.0.0.0            リンク上         127.0.0.1    331
        224.0.0.0        240.0.0.0            リンク上       192.168.0.4    286
        224.0.0.0        240.0.0.0            リンク上     192.168.112.1    271
  255.255.255.255  255.255.255.255            リンク上         127.0.0.1    331
  255.255.255.255  255.255.255.255            リンク上       192.168.0.4    286
  255.255.255.255  255.255.255.255            リンク上     192.168.112.1    271
===========================================================================
固定ルート:
  なし
```

## ルーティングテーブル
```
ip route show
default via 192.168.112.1 dev eth0 proto kernel
192.168.112.0/20 dev eth0 proto kernel scope link src 192.168.125.206
```
### 追加
```
$ sudo ip route add 10.0.0.0/24 via 192.168.112.1 dev eth0
$ ip route
default via 192.168.112.1 dev eth0 proto kernel
10.0.0.0/24 via 192.168.112.1 dev eth0
192.168.112.0/20 dev eth0 proto kernel scope link src 192.168.125.206

$ traceroute 10.0.0.5
traceroute to 10.0.0.5 (10.0.0.5), 30 hops max, 60 byte packets
 1  tokunaga.mshome.net (192.168.112.1)  0.536 ms  0.513 ms  0.506 ms
 2  router.askey.net (192.168.0.1)  6.830 ms  6.825 ms  6.818 ms
 3  * * *
 4  * * *
 5  * * *
 6  * * *
 7  * * *
```
ルーティングはできているが、ルータ到達時点でルーティング設定が存在しないため破棄される
192.168.0.0/24   → LAN
0.0.0.0/0        → WAN
### 削除
```
$ sudo ip route del 10.0.0.0/24
$ ip route
default via 192.168.112.1 dev eth0 proto kernel
192.168.112.0/20 dev eth0 proto kernel scope link src 192.168.125.206
```
