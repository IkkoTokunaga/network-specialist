2026-02-15
# ウィンドウサイズ
送信側でサーバのACK番号の返却を待って次のパケットを送信することは、待機時間が発生しとても時間が無駄となる。
だからといって際限なく送り続けるとサーバ側のバッファが溢れて過負荷となる可能性もある。
そこでTCPヘッダーのウィンドウサイズを設定行い、連続して送れるパケットサイズに制限を設ける。
制限に達した場合は送信側で送信を一度止め、サーバ側からのウィンドウサイズに空きが出るまで待機を行う。
## 初期設定
初期設定はサーバ側が設定する
主に受信バッファサイズ・メモリ状況や自動チューニング機能によって決定される
## 初期値の通知
3ウェイハンドシェイクのSYN/ACKで送信側に通知される
## 実Command
```
# curl -I https://www.google.com
tcpdump: listening on any, link-type LINUX_SLL2 (Linux cooked v2), snapshot length 262144 bytes
## 3ウェイハンドシェイク SYN
22:55:20.161788 eth0  Out IP (tos 0x0, ttl 64, id 35723, offset 0, flags [DF], proto TCP (6), length 60)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [S], cksum 0x9544 (incorrect -> 0x4f6d), seq 2864404791, win 64240, options [mss 1460,sackOK,TS val 3971468377 ecr 0,nop,wscale 7], length 0
## SYN/ACK
22:55:20.184895 eth0  In  IP (tos 0x0, ttl 122, id 0, offset 0, flags [DF], proto TCP (6), length 60)
    142.250.199.164.443 > 192.168.125.206.43468: Flags [S.], cksum 0xa19b (correct), seq 2264793408, ack 2864404792, win 65535, options [mss 1412,sackOK,TS val 3021040784 ecr 3971468377,nop,wscale 8], length 0
## ACK
22:55:20.184988 eth0  Out IP (tos 0x0, ttl 64, id 35724, offset 0, flags [DF], proto TCP (6), length 52)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [.], cksum 0x953c (incorrect -> 0xce2b), seq 1, ack 1, win 502, options [nop,nop,TS val 3971468400 ecr 3021040784], length 0
## ここから実データ
22:55:20.242777 eth0  Out IP (tos 0x0, ttl 64, id 35725, offset 0, flags [DF], proto TCP (6), length 569)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [P.], cksum 0x9741 (incorrect -> 0x4ef3), seq 1:518, ack 1, win 502, options [nop,nop,TS val 3971468458 ecr 3021040784], length 517
22:55:20.264304 eth0  In  IP (tos 0x0, ttl 122, id 64940, offset 0, flags [none], proto TCP (6), length 52)
    142.250.199.164.443 > 192.168.125.206.43468: Flags [.], cksum 0xc97a (correct), seq 1, ack 518, win 1048, options [nop,nop,TS val 3021040864 ecr 3971468458], length 0
22:55:20.268713 eth0  In  IP (tos 0x0, ttl 122, id 64941, offset 0, flags [none], proto TCP (6), length 2852)
    142.250.199.164.443 > 192.168.125.206.43468: Flags [P.], cksum 0xa02c (incorrect -> 0x45be), seq 1:2801, ack 518, win 1050, options [nop,nop,TS val 3021040866 ecr 3971468458], length 2800
22:55:20.268713 eth0  In  IP (tos 0x0, ttl 122, id 64943, offset 0, flags [none], proto TCP (6), length 1371)
    142.250.199.164.443 > 192.168.125.206.43468: Flags [P.], cksum 0xd406 (correct), seq 2801:4120, ack 518, win 1050, options [nop,nop,TS val 3021040866 ecr 3971468458], length 1319
22:55:20.268772 eth0  Out IP (tos 0x0, ttl 64, id 35726, offset 0, flags [DF], proto TCP (6), length 52)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [.], cksum 0x953c (incorrect -> 0xc064), seq 518, ack 2801, win 546, options [nop,nop,TS val 3971468484 ecr 3021040866], length 0
22:55:20.268782 eth0  Out IP (tos 0x0, ttl 64, id 35727, offset 0, flags [DF], proto TCP (6), length 52)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [.], cksum 0x953c (incorrect -> 0xbb27), seq 518, ack 4120, win 568, options [nop,nop,TS val 3971468484 ecr 3021040866], length 0
22:55:20.271856 eth0  Out IP (tos 0x0, ttl 64, id 35728, offset 0, flags [DF], proto TCP (6), length 132)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [P.], cksum 0x958c (incorrect -> 0x55ad), seq 518:598, ack 4120, win 568, options [nop,nop,TS val 3971468487 ecr 3021040866], length 80
22:55:20.272023 eth0  Out IP (tos 0x0, ttl 64, id 35729, offset 0, flags [DF], proto TCP (6), length 147)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [P.], cksum 0x959b (incorrect -> 0xf896), seq 598:693, ack 4120, win 568, options [nop,nop,TS val 3971468487 ecr 3021040866], length 95
22:55:20.272072 eth0  Out IP (tos 0x0, ttl 64, id 35730, offset 0, flags [DF], proto TCP (6), length 154)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [P.], cksum 0x95a2 (incorrect -> 0xc3dd), seq 693:795, ack 4120, win 568, options [nop,nop,TS val 3971468487 ecr 3021040866], length 102
22:55:20.294595 eth0  In  IP (tos 0x0, ttl 122, id 64944, offset 0, flags [none], proto TCP (6), length 700)
    142.250.199.164.443 > 192.168.125.206.43468: Flags [P.], cksum 0xdf79 (correct), seq 4120:4768, ack 795, win 1050, options [nop,nop,TS val 3021040894 ecr 3971468487], length 648
22:55:20.295064 eth0  Out IP (tos 0x0, ttl 64, id 35731, offset 0, flags [DF], proto TCP (6), length 83)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [P.], cksum 0x955b (incorrect -> 0x9afc), seq 795:826, ack 4768, win 590, options [nop,nop,TS val 3971468510 ecr 3021040894], length 31
22:55:20.296406 eth0  In  IP (tos 0x0, ttl 122, id 64945, offset 0, flags [none], proto TCP (6), length 83)
    142.250.199.164.443 > 192.168.125.206.43468: Flags [P.], cksum 0x55ef (correct), seq 4768:4799, ack 795, win 1050, options [nop,nop,TS val 3021040896 ecr 3971468487], length 31
22:55:20.323456 eth0  In  IP (tos 0x0, ttl 122, id 64946, offset 0, flags [none], proto TCP (6), length 52)
    142.250.199.164.443 > 192.168.125.206.43468: Flags [.], cksum 0xb517 (correct), seq 4799, ack 826, win 1050, options [nop,nop,TS val 3021040923 ecr 3971468510], length 0
22:55:20.338939 eth0  Out IP (tos 0x0, ttl 64, id 35732, offset 0, flags [DF], proto TCP (6), length 52)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [.], cksum 0x953c (incorrect -> 0xb6d2), seq 826, ack 4799, win 590, options [nop,nop,TS val 3971468554 ecr 3021040896], length 0
22:55:20.392244 eth0  In  IP (tos 0x0, ttl 122, id 64947, offset 0, flags [none], proto TCP (6), length 1094)
    142.250.199.164.443 > 192.168.125.206.43468: Flags [P.], cksum 0x3f85 (correct), seq 4799:5841, ack 826, win 1050, options [nop,nop,TS val 3021040991 ecr 3971468554], length 1042
22:55:20.392341 eth0  Out IP (tos 0x0, ttl 64, id 35733, offset 0, flags [DF], proto TCP (6), length 52)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [.], cksum 0x953c (incorrect -> 0xb216), seq 826, ack 5841, win 612, options [nop,nop,TS val 3971468607 ecr 3021040991], length 0
22:55:20.392647 eth0  Out IP (tos 0x0, ttl 64, id 35734, offset 0, flags [DF], proto TCP (6), length 91)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [P.], cksum 0x9563 (incorrect -> 0x8cdc), seq 826:865, ack 5841, win 612, options [nop,nop,TS val 3971468608 ecr 3021040991], length 39
22:55:20.393145 eth0  Out IP (tos 0x0, ttl 64, id 35735, offset 0, flags [DF], proto TCP (6), length 76)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [P.], cksum 0x9554 (incorrect -> 0x2c8f), seq 865:889, ack 5841, win 612, options [nop,nop,TS val 3971468608 ecr 3021040991], length 24
22:55:20.393944 eth0  Out IP (tos 0x0, ttl 64, id 35736, offset 0, flags [DF], proto TCP (6), length 52)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [F.], cksum 0x953c (incorrect -> 0xb1d4), seq 889, ack 5841, win 612, options [nop,nop,TS val 3971468609 ecr 3021040991], length 0
22:55:20.416515 eth0  In  IP (tos 0x0, ttl 122, id 64948, offset 0, flags [none], proto TCP (6), length 52)
    142.250.199.164.443 > 192.168.125.206.43468: Flags [.], cksum 0xb020 (correct), seq 5841, ack 865, win 1050, options [nop,nop,TS val 3021041015 ecr 3971468608], length 0
22:55:20.416516 eth0  In  IP (tos 0x0, ttl 122, id 64949, offset 0, flags [none], proto TCP (6), length 52)
    142.250.199.164.443 > 192.168.125.206.43468: Flags [.], cksum 0xb008 (correct), seq 5841, ack 889, win 1050, options [nop,nop,TS val 3021041015 ecr 3971468608], length 0
22:55:20.416841 eth0  In  IP (tos 0x0, ttl 122, id 64950, offset 0, flags [none], proto TCP (6), length 52)
    142.250.199.164.443 > 192.168.125.206.43468: Flags [F.], cksum 0xb007 (correct), seq 5841, ack 889, win 1050, options [nop,nop,TS val 3021041015 ecr 3971468608], length 0
22:55:20.416865 eth0  Out IP (tos 0x0, ttl 64, id 35737, offset 0, flags [DF], proto TCP (6), length 52)
    192.168.125.206.43468 > 142.250.199.164.443: Flags [.], cksum 0x953c (incorrect -> 0xb1a4), seq 890, ack 5842, win 612, options [nop,nop,TS val 3971468632 ecr 3021041015], length 0
22:55:20.417905 eth0  In  IP (tos 0x0, ttl 122, id 64951, offset 0, flags [none], proto TCP (6), length 52)
    142.250.199.164.443 > 192.168.125.206.43468: Flags [.], cksum 0xb004 (correct), seq 5842, ack 890, win 1050, options [nop,nop,TS val 3021041016 ecr 3971468609], length 0
```