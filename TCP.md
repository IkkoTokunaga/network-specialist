2026-01-27
# TCP（Transmission Control Protocol）
トランスポート層で使用されるプロトコル
TCPヘッダーを付加、そのヘッダーによって処理されるデータのことをTCPセグメントという。
## TCPでしっかり送る
信頼性が求められるアプリケーションで使用される
+ メール
+ ファイル転送
+ Webブラウザ
## 3ウェイハンドシェイク
コネクションを確立する前の挨拶的な処理手順のこと
アクティブオープン：TCPコネクションを作りに行く側（クライアント側）
パッシブオープン：受け付ける側（サーバ側）
### フラグ
TCPセグメント内、コントロールビットのフラグ
3ウェイハンドシェイクは必ず「SYN」→「SYN/ACK」→「ACK」の順序となる
### シーケンス番号
データの順序を表す番号
### オプションヘッダ
TCPの各種拡張機能を通知しあうために使用される
代表的なオプション
| 種類番号 (Kind) | オプション名                     | 長さ | 主な役割・意味          | 主に使われるタイミング |
| ----------- | -------------------------- | -- | ---------------- | ----------- |
| 0           | End of Option List (EOL)   | 1  | オプション終了を示す       | 常時          |
| 1           | No-Operation (NOP)         | 1  | パディング（4byte境界調整） | 常時          |
| 2           | MSS (Maximum Segment Size) | 4  | 1セグメントの最大データサイズ  | **SYNのみ**   |
| 3           | Window Scale               | 3  | 受信ウィンドウ拡張        | **SYNのみ**   |
| 4           | SACK Permitted             | 2  | SACK使用可の宣言       | **SYNのみ**   |
| 8           | Timestamps                 | 10 | RTT測定・PAWS対策     | SYN / 通信中   |
## 4ウェイハンドシェイク
TCPコネクションを終了するための処理手順のこと
### FINフラグ
どちらからFINを出すとは決まっていない
「FIN/ACK」→「ACK」→「FIN/ACK」→「ACK」と順番で処理される
2ウェイハンドシェイクが2回行われるイメージ
### TIME-WAIT
コネクションを閉じるときはTIME-WAITで設定されている時間だけ、待機して終了する。
これはもしかしたら届くかもしれないパケットを待つ保険のようなもの
Windowsは120秒
Linux系は60秒
がデフォルト設定